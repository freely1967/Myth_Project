<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Greek Mythology Graph</title>

    <!-- Load dependencies first -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/neo4j-driver/5.15.0/neo4j-driver.min.js"></script>

    <style>
        /* Same styling as your original file (unchanged) */
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            overflow: hidden;
        }

        .container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            z-index: 1000;
            position: relative;
        }

        .header h1 {
            margin: 0;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .graph-container {
            width: 100%;
            height: calc(100vh - 120px);
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 15px;
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .node {
            cursor: pointer;
            stroke-width: 3px;
            filter: drop-shadow(0 0 6px rgba(255, 215, 0, 0.6));
        }

        .node:hover {
            filter: drop-shadow(0 0 12px rgba(255, 215, 0, 1));
            transform: scale(1.1);
        }

        .link {
            stroke: rgba(255, 215, 0, 0.6);
            stroke-width: 2px;
            filter: drop-shadow(0 0 3px rgba(255, 215, 0, 0.3));
        }

        .node-label {
            font-family: 'Segoe UI', sans-serif;
            font-size: 14px;
            font-weight: bold;
            fill: white;
            text-anchor: middle;
            dominant-baseline: central;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
            pointer-events: none;
        }

        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ffd700;
            font-size: 12px;
            pointer-events: none;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
        }

        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5em;
            text-align: center;
        }

        .legend,
        .controls {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 215, 0, 0.5);
            font-size: 12px;
        }

        .legend {
            top: 20px;
            right: 20px;
        }

        .controls {
            bottom: 20px;
            left: 20px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
            border: 2px solid rgba(255, 215, 0, 0.3);
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>Greek Mythology Family Tree</h1>
        </div>

        <div class="graph-container">
            <div id="loading" class="loading">
                <div>üèõÔ∏è Loading Greek Mythology Data...</div>
                <div style="font-size: 0.8em; margin-top: 10px;">Connecting to Neo4j...</div>
            </div>
            <svg id="graph"></svg>
        </div>

        <div class="legend">
            <h3 style="margin-top: 0; color: #ffd700;">Legend</h3>
            <div class="legend-item">
                <div class="legend-color" style="background: #ff6b6b;"></div><span>Olympian Gods</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #4ecdc4;"></div><span>Greek Deities</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #45b7d1;"></div><span>Lunar Deities</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #96ceb4;"></div><span>Goddesses</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #feca57;"></div><span>Mythological Characters</span>
            </div>
        </div>

        <div class="controls">
            <h3 style="margin-top: 0; color: #ffd700;">Controls</h3>
            <div>üñ±Ô∏è Click and drag nodes to move them</div>
            <div>üîç Hover over nodes for details</div>
            <div>‚ö° Double-click to center the graph</div>
        </div>

        <div class="tooltip" id="tooltip" style="display: none;"></div>
    </div>

    <!-- Your app logic goes at the end of the body, after all libraries are loaded -->
    <script>
        window.onload = async function () {
            const driver = neo4j.driver(
                'neo4j+s://10634e70.databases.neo4j.io',
                neo4j.auth.basic('neo4j', 'jTeHUI2t2iie3kZyLGVNJtmnQqdjHAP6Lcfo0FkzfuI')
            );

            const colorMap = {
                'Olympian god': '#ff6b6b',
                'Greek deity': '#4ecdc4',
                'lunar deity': '#45b7d1',
                'goddess': '#96ceb4',
                'mythological Greek character': '#feca57'
            };

            const container = document.querySelector('.graph-container');
            const width = container.clientWidth;
            const height = container.clientHeight;

            const svg = d3.select('#graph')
                .attr('width', width)
                .attr('height', height);

            const tooltip = d3.select('#tooltip');

            const simulation = d3.forceSimulation()
                .force('link', d3.forceLink().id(d => d.id).distance(100))
                .force('charge', d3.forceManyBody().strength(-300))
                .force('center', d3.forceCenter(width / 2, height / 2))
                .force('collision', d3.forceCollide().radius(40));

            async function loadGraphData() {
                const session = driver.session();
                try {
                    const result = await session.run(`
                        MATCH (n)
                        OPTIONAL MATCH (n)-[r]->(m)
                        RETURN n, r, m
                    `);

                    const nodes = new Map();
                    const links = [];

                    result.records.forEach(record => {
                        const node = record.get('n');
                        const relationship = record.get('r');
                        const targetNode = record.get('m');

                        if (node && !nodes.has(node.properties.id)) {
                            nodes.set(node.properties.id, {
                                id: node.properties.id,
                                label: node.properties.label || node.properties.id,
                                type: node.properties.type,
                                color: colorMap[node.properties.type] || '#888888'
                            });
                        }

                        if (targetNode && relationship) {
                            if (!nodes.has(targetNode.properties.id)) {
                                nodes.set(targetNode.properties.id, {
                                    id: targetNode.properties.id,
                                    label: targetNode.properties.label || targetNode.properties.id,
                                    type: targetNode.properties.type,
                                    color: colorMap[targetNode.properties.type] || '#888888'
                                });
                            }

                            links.push({
                                source: node.properties.id,
                                target: targetNode.properties.id,
                                type: relationship.properties.type || relationship.type,
                                relationship: relationship.type
                            });
                        }
                    });

                    return {
                        nodes: Array.from(nodes.values()),
                        links: links
                    };
                } finally {
                    await session.close();
                }
            }

            function createVisualization(graphData) {
                document.getElementById('loading').style.display = 'none';

                const link = svg.append('g')
                    .selectAll('line')
                    .data(graphData.links)
                    .enter().append('line')
                    .attr('class', 'link');

                const node = svg.append('g')
                    .selectAll('circle')
                    .data(graphData.nodes)
                    .enter().append('circle')
                    .attr('class', 'node')
                    .attr('r', d => d.id === 'Zeus' ? 25 : 20)
                    .attr('fill', d => d.color)
                    .attr('stroke', '#ffd700')
                    .call(d3.drag()
                        .on('start', dragstarted)
                        .on('drag', dragged)
                        .on('end', dragended));

                const labels = svg.append('g')
                    .selectAll('text')
                    .data(graphData.nodes)
                    .enter().append('text')
                    .attr('class', 'node-label')
                    .text(d => d.label)
                    .style('font-size', d => d.id === 'Zeus' ? '16px' : '14px');

                node.on('mouseover', function (event, d) {
                    tooltip
                        .style('display', 'block')
                        .style('left', (event.pageX + 10) + 'px')
                        .style('top', (event.pageY - 10) + 'px')
                        .html(`<strong>${d.label}</strong><br/>Type: ${d.type}<br/>ID: ${d.id}`);
                }).on('mouseout', function () {
                    tooltip.style('display', 'none');
                });

                svg.on('dblclick', function () {
                    simulation.alpha(0.3).restart();
                });

                simulation.nodes(graphData.nodes).on('tick', ticked);
                simulation.force('link').links(graphData.links);

                function ticked() {
                    link
                        .attr('x1', d => d.source.x)
                        .attr('y1', d => d.source.y)
                        .attr('x2', d => d.target.x)
                        .attr('y2', d => d.target.y);

                    node
                        .attr('cx', d => d.x)
                        .attr('cy', d => d.y);

                    labels
                        .attr('x', d => d.x)
                        .attr('y', d => d.y);
                }

                function dragstarted(event, d) {
                    if (!event.active) simulation.alphaTarget(0.3).restart();
                    d.fx = d.x;
                    d.fy = d.y;
                }

                function dragged(event, d) {
                    d.fx = event.x;
                    d.fy = event.y;
                }

                function dragended(event, d) {
                    if (!event.active) simulation.alphaTarget(0);
                    d.fx = null;
                    d.fy = null;
                }
            }

            // Load and show graph
            loadGraphData()
                .then(createVisualization)
                .catch(error => {
                    console.error('Error loading graph data:', error);
                    document.getElementById('loading').innerHTML = `
                        <div style="color: #ff6b6b;">‚ùå Error loading data</div>
                        <div style="font-size: 0.8em; margin-top: 10px;">${error.message}</div>
                    `;
                });

            window.addEventListener('beforeunload', () => {
                driver.close();
            });
        };
    </script>
</body>

</html>